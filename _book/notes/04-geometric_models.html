<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniela Palleschi">

<title>Statistical Rethinking - 3&nbsp; Geocentric Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references.html" rel="next">
<link href="../notes/03-sampling.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: {autoNumber: "AMS"} },
  tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"] ]}
});
</script>

<!-- This is what works with Quarto -->
<script>
  MathJax = {
    tex: {
      tags: 'ams'  // should be 'ams', 'none', or 'all'
    }
  };
</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/02-small_worlds.html">Chapter notes</a></li><li class="breadcrumb-item"><a href="../notes/04-geometric_models.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geocentric Models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Statistical Rethinking</a> 
        <div class="sidebar-tools-main">
    <a href="../Statistical-Rethinking.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Overview</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Set-up</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Chapter notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/02-small_worlds.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Small Worlds and Large Worlds</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/03-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Sampling the Imaginary</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/04-geometric_models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geocentric Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#resources" id="toc-resources" class="nav-link active" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set-up</a></li>
  <li><a href="#permission-to-be-confused" id="toc-permission-to-be-confused" class="nav-link" data-scroll-target="#permission-to-be-confused">Permission to be confused</a></li>
  <li><a href="#the-geocentric-model" id="toc-the-geocentric-model" class="nav-link" data-scroll-target="#the-geocentric-model">The Geocentric Model</a></li>
  <li><a href="#why-normal-distributions-are-normal" id="toc-why-normal-distributions-are-normal" class="nav-link" data-scroll-target="#why-normal-distributions-are-normal"><span class="header-section-number">3.1</span> Why normal distributions are normal</a>
  <ul class="collapse">
  <li><a href="#normal-by-multiplication" id="toc-normal-by-multiplication" class="nav-link" data-scroll-target="#normal-by-multiplication"><span class="header-section-number">3.1.1</span> Normal by multiplication</a></li>
  <li><a href="#normal-by-log-multiplication" id="toc-normal-by-log-multiplication" class="nav-link" data-scroll-target="#normal-by-log-multiplication"><span class="header-section-number">3.1.2</span> Normal by log-multiplication</a></li>
  <li><a href="#using-gaussian-distributions" id="toc-using-gaussian-distributions" class="nav-link" data-scroll-target="#using-gaussian-distributions"><span class="header-section-number">3.1.3</span> Using Gaussian distributions</a></li>
  </ul></li>
  <li><a href="#a-language-for-describing-models" id="toc-a-language-for-describing-models" class="nav-link" data-scroll-target="#a-language-for-describing-models"><span class="header-section-number">3.2</span> A language for describing models</a></li>
  <li><a href="#a-gaussian-model-of-height" id="toc-a-gaussian-model-of-height" class="nav-link" data-scroll-target="#a-gaussian-model-of-height"><span class="header-section-number">3.3</span> A Gaussian model of height</a>
  <ul class="collapse">
  <li><a href="#finding-the-posterior-distribution-with-quap" id="toc-finding-the-posterior-distribution-with-quap" class="nav-link" data-scroll-target="#finding-the-posterior-distribution-with-quap"><span class="header-section-number">3.3.1</span> Finding the posterior distribution with <code>quap</code></a></li>
  <li><a href="#simulate-weights" id="toc-simulate-weights" class="nav-link" data-scroll-target="#simulate-weights"><span class="header-section-number">3.3.2</span> Simulate weights</a></li>
  <li><a href="#describing-models" id="toc-describing-models" class="nav-link" data-scroll-target="#describing-models"><span class="header-section-number">3.3.3</span> Describing models</a></li>
  <li><a href="#estimator" id="toc-estimator" class="nav-link" data-scroll-target="#estimator"><span class="header-section-number">3.3.4</span> Estimator</a></li>
  <li><a href="#posterior-distribution" id="toc-posterior-distribution" class="nav-link" data-scroll-target="#posterior-distribution"><span class="header-section-number">3.3.5</span> Posterior distribution</a></li>
  <li><a href="#grid-approximat-posterior" id="toc-grid-approximat-posterior" class="nav-link" data-scroll-target="#grid-approximat-posterior"><span class="header-section-number">3.3.6</span> Grid approximat posterior</a></li>
  <li><a href="#quardratic-approximation" id="toc-quardratic-approximation" class="nav-link" data-scroll-target="#quardratic-approximation"><span class="header-section-number">3.3.7</span> Quardratic approximation</a></li>
  </ul></li>
  <li><a href="#linear-prediction-adding-a-predictor" id="toc-linear-prediction-adding-a-predictor" class="nav-link" data-scroll-target="#linear-prediction-adding-a-predictor"><span class="header-section-number">3.4</span> Linear Prediction: Adding a predictor</a></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression"><span class="header-section-number">3.5</span> Polynomial regression</a></li>
  <li><a href="#solomon-kurz" id="toc-solomon-kurz" class="nav-link" data-scroll-target="#solomon-kurz"><span class="header-section-number">3.6</span> Solomon Kurz</a>
  <ul class="collapse">
  <li><a href="#fitting-a-model-with-brm" id="toc-fitting-a-model-with-brm" class="nav-link" data-scroll-target="#fitting-a-model-with-brm"><span class="header-section-number">3.6.1</span> Fitting a model with <code>brm()</code></a></li>
  <li><a href="#sampleing-from-a-brm-fit" id="toc-sampleing-from-a-brm-fit" class="nav-link" data-scroll-target="#sampleing-from-a-brm-fit"><span class="header-section-number">3.6.2</span> Sampleing from a <code>brm()</code> fit</a></li>
  </ul></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">3.7</span> Practice</a>
  <ul class="collapse">
  <li><a href="#e1" id="toc-e1" class="nav-link" data-scroll-target="#e1">E1</a></li>
  <li><a href="#e2" id="toc-e2" class="nav-link" data-scroll-target="#e2">E2</a></li>
  <li><a href="#e3" id="toc-e3" class="nav-link" data-scroll-target="#e3">E3</a></li>
  <li><a href="#e4" id="toc-e4" class="nav-link" data-scroll-target="#e4">E4</a></li>
  <li><a href="#e5" id="toc-e5" class="nav-link" data-scroll-target="#e5">E5</a></li>
  <li><a href="#m1" id="toc-m1" class="nav-link" data-scroll-target="#m1">M1</a></li>
  <li><a href="#sampling-from-the-posterior" id="toc-sampling-from-the-posterior" class="nav-link" data-scroll-target="#sampling-from-the-posterior"><span class="header-section-number">3.7.1</span> Sampling from the posterior</a></li>
  <li><a href="#m2" id="toc-m2" class="nav-link" data-scroll-target="#m2">M2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Geocentric Models</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Chapter 4 in McElreath (2020)</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Daniela Palleschi </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>My notes for this chapter are a bit muddled, I did a mix of reading the textbook and watching the YouTube video. Unfortuantely the YouTube video doesn’t map onto the chapter very transparently and even has code that isn’t in the current textbook version, so some concepts might be repeated/out of order.</p>
<section id="resources" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=tNOu-SEacNU&amp;list=PLDcUM9US4XdPz-KxHM4XHt7uUVGWWVSus&amp;index=4&amp;t=1208s">YouTube lecture (2023): Geocentric Models</a></li>
<li>Solomon Kurz: <a href="https://bookdown.org/content/3890/linear-models.html">Linear models</a></li>
</ul>
</section>
<section id="set-up" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="set-up">Set-up</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  rethinking,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  tidyverse,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  janitor,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  knitr,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  kableExtra</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="permission-to-be-confused" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="permission-to-be-confused">Permission to be confused</h2>
<p>From ~ 20 minute mark from the YouTue video</p>
<ul>
<li>you don’t need to understand everything all at once
<ul>
<li>math, concepts, code, installation problems etc.</li>
</ul></li>
<li>it’s important to keep some <em>flow</em>
<ul>
<li>keep moving forward despite the resistance of confusion/struggle</li>
<li>things shouldn’t be too hard, because then you stop moving</li>
<li>if it’s too easy, you don’t feel any resistance</li>
<li>feeling confused means you’re paying attention :)</li>
</ul></li>
</ul>
</section>
<section id="the-geocentric-model" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="the-geocentric-model">The Geocentric Model</h2>
<ul>
<li><p>planets have been observed to have a zig-zag orbit from the perspective of Earth</p></li>
<li><p>Geocentric model/Telomeric model</p>
<ul>
<li>used to predict the pattern of planets orbit, with the prior of Earth at the centre of the solar system</li>
</ul></li>
<li><p>the geocentric model was very accurate</p>
<ul>
<li>however, the orbits of the planets are elliptical and orbit around the <em>sun</em>, not the earth</li>
</ul></li>
<li><p>so models built on inaccurate assumptions can still be very accurate in their predictions</p></li>
<li><p>the orbits of the planets are embedded witin each other (based on their proximity to the sun), so there is a point when two planets’ orbits are closer to each other, i.e., when their orbits have them closer together</p>
<ul>
<li>which is how the perception of Mars’ zig-zag orbit (and other planets, but it’s more stricking for Mars)</li>
</ul></li>
<li><p>in 1809: Bayesian argument for normal error and least-squares estimation from Gauss</p></li>
<li><p><strong>Geocentric</strong>: describes association, makes predictions, but mechanisticalistically wrong</p>
<ul>
<li>the problem is not the model itself, rather some external causal model we project onto the model</li>
<li>geocentric models are still extremely useful, what’s wrong is believing they’re <em>true</em> reflections of e.g., the solar system</li>
<li>there’s also nothing wrong with linear regression itself, as long as we don’t believe they’re an accurate mechanistic model of the system we’re studying</li>
</ul></li>
<li><p><strong>Gaussian</strong>: abstracts from generative error model, replaces with normal distribution, mechanistically silent</p>
<ul>
<li>usually a pretty good approximation of associations</li>
<li>we will be using gaussian error models</li>
</ul></li>
<li><p>useful when handled <em>with care</em></p>
<ul>
<li>many special cases: ANOVA, ANCOVA, t-test, etc.</li>
</ul></li>
</ul>
</section>
<section id="why-normal-distributions-are-normal" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="why-normal-distributions-are-normal"><span class="header-section-number">3.1</span> Why normal distributions are normal</h2>
<section id="normal-by-multiplication" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="normal-by-multiplication"><span class="header-section-number">3.1.1</span> Normal by multiplication</h3>
</section>
<section id="normal-by-log-multiplication" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="normal-by-log-multiplication"><span class="header-section-number">3.1.2</span> Normal by log-multiplication</h3>
</section>
<section id="using-gaussian-distributions" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="using-gaussian-distributions"><span class="header-section-number">3.1.3</span> Using Gaussian distributions</h3>
</section>
</section>
<section id="a-language-for-describing-models" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="a-language-for-describing-models"><span class="header-section-number">3.2</span> A language for describing models</h2>
</section>
<section id="a-gaussian-model-of-height" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="a-gaussian-model-of-height"><span class="header-section-number">3.3</span> A Gaussian model of height</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load Howell1 data from rethinking package</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1) </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_weight <span class="ot">&lt;-</span> Howell1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   height   weight age male
1 151.765 47.82561  63    1
2 139.700 36.48581  63    0
3 136.525 31.86484  65    0
4 156.845 53.04191  41    1
5 145.415 41.27687  51    0
6 163.830 62.99259  35    1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     height           weight            age             male       
 Min.   : 53.98   Min.   : 4.252   Min.   : 0.00   Min.   :0.0000  
 1st Qu.:125.09   1st Qu.:22.008   1st Qu.:12.00   1st Qu.:0.0000  
 Median :148.59   Median :40.058   Median :27.00   Median :0.0000  
 Mean   :138.26   Mean   :35.611   Mean   :29.34   Mean   :0.4724  
 3rd Qu.:157.48   3rd Qu.:47.209   3rd Qu.:43.00   3rd Qu.:1.0000  
 Max.   :179.07   Max.   :62.993   Max.   :88.00   Max.   :1.0000  </code></pre>
</div>
</div>
<ul>
<li>age ranges from babies to seniors</li>
<li>sex as binary</li>
<li>height in cm</li>
<li>weight in kg</li>
</ul>
<p><code>precis()</code> function from rethinking package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(df_weight) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="kable_wrapper table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<tbody>
<tr class="odd">
<td><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">138.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">35.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">29.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table></td>
<td><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">27.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">14.7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">20.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.5</td>
</tr>
</tbody>
</table></td>
<td><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">81.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">9.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0</td>
</tr>
</tbody>
</table></td>
<td><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">165.7</td>
</tr>
<tr class="even">
<td style="text-align: right;">54.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">66.1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.0</td>
</tr>
</tbody>
</table></td>
<td><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">▁▁▁▁▁▁▁▂▁▇▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">▁▂▃▂▂▂▂▅▇▇▃▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">▇▅▅▃▅▂▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
</tbody>
</table></td>
</tr>
</tbody>
</table>


</div>
</div>
<p>To define heights as normally distributed, we write <span class="math inline">\(\ref{eq-height-gauss}\)</span>, where <span class="math inline">\(i\)</span> stands for index. <span class="math inline">\(\ref{eq-height-gauss}\)</span> is saying that all the golem (i.e., our model) knows about each observed height measurement is defined by the same normal distribution with mean <span class="math inline">\(\mu\)</span> and standard deviation <span class="math inline">\(\sigma\)</span>.</p>
<p><span class="math display">\[\begin{align}
h_i \sim Normal(\mu, \sigma) \label{eq-height-gauss} \\
\mu \sim Normal(178, 20) \label{eq-height-prior-mu} \\
\sigma \sim Uniform(0, 50) \label{eq-height-prior-sigma}
\end{align}\]</span></p>
<p><span class="math inline">\(\ref{eq-height-prior-mu}\)</span> represents our <em>prior</em> for <span class="math inline">\(\mu\)</span>, where our assumed mean is 178 cm (because Richard McElreath is 178cm tall), with a 95% probability between +/- 40cm (because if the SD is 20cm, 20 x 1.96 is approximately 20 x 2).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.10</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data for adults only</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> df_weight <span class="sc">|&gt;</span> <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot our priors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code chunk 4.12</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="dv">178</span>, <span class="dv">20</span>), <span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Or, with ggplot (from <a href="https://bookdown.org/content/3890/linear-models.html#a-gaussian-model-of-height">Solomon Kurz</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> .<span class="dv">1</span>)), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can also view our prior for <span class="math inline">\(\sigma\)</span>, which is a flat (uniform) prior:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code chunk 4.13</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dunif</span>(x, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And with ggplot (from <a href="https://bookdown.org/content/3890/linear-models.html#a-gaussian-model-of-height">Solomon Kurz</a>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dunif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>))) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A standard deviation must be positiion, and so we’ve bound it at zero. Picking the upperbound is another question: in our case a sd of 50cm would imply that 95% of individual heights lie within 100cm of the average height (again, because SD * 1.96), which is a very large range.</p>
<p>Now it’s time for a ~prior predictive~ simulation, for which we need our chosen priors for <span class="math inline">\(h, \mu,\)</span> and <span class="math inline">\(\sigma\)</span>, which imply a joint prior distribution of individual heights.</p>
<p>Let’s quickly simiulate heights by sampling from our prior. We can process priors just like posteriors, because every posterior is also potentially a prior for a subsequent analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.14</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And sampling from both <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span> priors to get a prior probability of heights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>,       <span class="at">sd  =</span> <span class="dv">20</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min  =</span> <span class="dv">0</span>,         <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd  =</span> sample_sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span><span class="st">"for"</span><span class="sc">~</span><span class="fu">italic</span>(h[i])),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="finding-the-posterior-distribution-with-quap" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="finding-the-posterior-distribution-with-quap"><span class="header-section-number">3.3.1</span> Finding the posterior distribution with <code>quap</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 2.23</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">sample</span>( d2<span class="sc">$</span>height , <span class="at">size=</span><span class="dv">20</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.24</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">170</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">4</span> , <span class="at">to=</span><span class="dv">20</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>post2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( <span class="at">mu=</span>mu.list , <span class="at">sigma=</span>sigma.list ) </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="cf">function</span>(i) <span class="fu">sum</span>( <span class="fu">dnorm</span>( d3 , <span class="at">mean=</span>post2<span class="sc">$</span>mu[i] , <span class="at">sd=</span>post2<span class="sc">$</span>sigma[i] , <span class="at">log=</span><span class="cn">TRUE</span> ) ) )</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>prod <span class="ot">&lt;-</span> post2<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post2<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span> ) <span class="sc">+</span> <span class="fu">dunif</span>( post2<span class="sc">$</span>sigma , <span class="dv">0</span> , <span class="dv">50</span> , <span class="cn">TRUE</span> ) </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>( post2<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post2<span class="sc">$</span>prod) )</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>sample2.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="at">size=</span><span class="fl">1e4</span> , <span class="at">replace=</span><span class="cn">TRUE</span> , <span class="at">prob=</span>post2<span class="sc">$</span>prob ) </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>sample2.mu <span class="ot">&lt;-</span> post2<span class="sc">$</span>mu[ sample2.rows ] </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>sample2.sigma <span class="ot">&lt;-</span> post2<span class="sc">$</span>sigma[ sample2.rows ]</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( sample2.mu , sample2.sigma , <span class="at">cex=</span><span class="fl">0.5</span> , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>) , <span class="at">xlab=</span><span class="st">"mu"</span> , <span class="at">ylab=</span><span class="st">"sigma"</span> , <span class="at">pch=</span><span class="dv">16</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.26</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span> , ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And define our model and place it into an <code>alist</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.27</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>flist <span class="ot">&lt;-</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(height <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma) , </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>        mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span> , <span class="dv">20</span>) , </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span> , <span class="dv">50</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fit a model to the data in <code>d2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.28</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(flist, <span class="at">data =</span> d2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Take a look.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.29</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            mean        sd       5.5%      94.5%
mu    154.606899 0.4119494 153.948524 155.265273
sigma   7.730482 0.2913059   7.264919   8.196045</code></pre>
</div>
</div>
</section>
<section id="simulate-weights" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="simulate-weights"><span class="header-section-number">3.3.2</span> Simulate weights</h3>
<p>From the GitHub script 03_howell etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># draw data</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">blank</span>(<span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>col2 <span class="ot">&lt;-</span> <span class="fu">col.alpha</span>(<span class="dv">2</span>,<span class="fl">0.8</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>height , d<span class="sc">$</span>weight , <span class="at">col=</span>col2 , <span class="at">lwd=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">1.2</span> , <span class="at">xlab=</span><span class="st">"height (cm)"</span> , <span class="at">ylab=</span><span class="st">"weight (kg)"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[ d<span class="sc">$</span>age<span class="sc">&gt;=</span><span class="dv">18</span> , ]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>height , d<span class="sc">$</span>weight , <span class="at">col=</span>col2 , <span class="at">lwd=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">1.2</span> , <span class="at">xlab=</span><span class="st">"height (cm)"</span> , <span class="at">ylab=</span><span class="st">"weight (kg)"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="describing-models" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="describing-models"><span class="header-section-number">3.3.3</span> Describing models</h3>
<p>(video c.&nbsp;31:00)</p>
<p>Conventional statistical model notaton:</p>
<ol type="1">
<li>list the variables in the model</li>
<li>define each variable as a deterministic or distributional function of the other variables</li>
</ol>
<ul>
<li>where does each variable get its value?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># function to simulate weights of individuals from height </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sim_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(H,b,sd) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(H), <span class="dv">0</span>, sd)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> b<span class="sc">*</span>H <span class="sc">+</span> U</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(W)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>this is a function of unobserved U, which has normal error</p></li>
<li><p>where W is a deterministic function of H and U together</p></li>
<li><p>this can be re-written with standard statistical notation as followed:</p></li>
</ul>
<p><span class="math display">\[\begin{align}
W_i &amp;= \beta H_i + U_i \label{eq-W} \\
U_i &amp;\sim Normal(0,\sigma) \label{eq-U} \\
H_i &amp;\sim Uniform(130,170) \label{eq-H}
\end{align}\]</span></p>
<p>Each of these is mirrored in a line of code. Along the left of the equations are the variables, along the right are their definitions. The subscripts indicate individuals (indexing).</p>
<ul>
<li><span class="math inline">\(=\)</span> indicates a <strong>deterministic</strong> relationship</li>
<li><span class="math inline">\(\sim\)</span> indicates a <strong>distributional</strong> relationship</li>
</ul>
<p>Equation <span class="math inline">\(\ref{eq-W}\)</span> is the equation for expected weight. Once we know the values to the right of this equation we can assign values to W. Equation <span class="math inline">\(\ref{eq-U}\)</span> represents Gaussian error with standard deviation sigma. Equation <span class="math inline">\(\ref{eq-H}\)</span> defines height as uniformly distributed from 130cm to 170cm. These are all defined in the code chunk above, but written in the opposite order. In the code it’s written in order of execution, but the statistical conventional notation sometimes has arbitrary order, but conventionally is stated in the opposite direction as the code is written because you start with the most general definition (<span class="math inline">\(\ref{eq-W}\)</span>) which depends on the other variables, and then you see how the variables W depends upon are defined. There’s a hierarchy that makes sense.</p>
</section>
<section id="estimator" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="estimator"><span class="header-section-number">3.3.4</span> Estimator</h3>
<p>We want to estimate how the average weight changes with height, i.e., how the average weight changes with height.</p>
<p><span class="math display">\[\begin{equation}
E(W_i|H_i) = \alpha + \beta H_i
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(E(W_i|H_i)\)</span> is the average weight conditional on height, <span class="math inline">\(\alpha\)</span> is the intercept and <span class="math inline">\(\beta\)</span> is our slope. So each height has a different average weight.</p>
</section>
<section id="posterior-distribution" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="posterior-distribution"><span class="header-section-number">3.3.5</span> Posterior distribution</h3>
<p>Good Bayesians estimate a posterior. The equation below is the same as that for when we tossed the globe, but we just have more unknowns now.</p>
<p><span class="math display">\[\begin{equation}
Pr(\alpha, \beta, \sigma|H_i, W_i) = \frac
{Pr(W_i|H_i, \alpha, \beta, \sigma)Pr(\alpha, \beta, \sigma)}
{Z}
\end{equation}\]</span></p>
<ul>
<li><span class="math inline">\(Pr(\alpha, \beta, \sigma|H_i, W_i)\)</span> is the posterior probability of a specific regression line, which is defined by , , and (unobserved variables). H and W are our <em>observed</em> data, we don’t need a posterior distribution for them, they’re observed (the likelihood).</li>
<li><span class="math inline">\(Pr(W_i|H_i, \alpha, \beta, \sigma)\)</span>: garden of forking data</li>
<li><span class="math inline">\(Pr(\alpha, \beta, \sigma)\)</span>: our priors</li>
<li><span class="math inline">\(Z\)</span>: a normalising constant that we don’t need to pay too much attention to, it ensures the lefthand side of the equation is a proper probability</li>
</ul>
<p>W is normally distributed with mean that is a a linear function of H.</p>
<p>These models are typically written as below:</p>
<p><span class="math display">\[\begin{align}
W_i &amp;= Normal(\mu_i, \sigma) \\
\mu_i &amp;\sim \alpha + \beta H_i
\end{align}\]</span></p>
</section>
<section id="grid-approximat-posterior" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="grid-approximat-posterior"><span class="header-section-number">3.3.6</span> Grid approximat posterior</h3>
<p>All posterior distributions begin with a single observations. There’s no minimum number of observations in Bayesian inference.</p>
</section>
<section id="quardratic-approximation" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="quardratic-approximation"><span class="header-section-number">3.3.7</span> Quardratic approximation</h3>
<ul>
<li>we’ll approximate the posterior distribution as a multivariate Gaussian distribution. We can do that because posterior distributions are typically multivariate Gaussian distributions if there are enough observations. A tool that does this for us is called <code>quap()</code> in the <code>statrethinking</code> package.</li>
</ul>
<p>The Gaussian distribution is quadratic, and in the log-space the Gaussian distribution is a perfect parabola (i.e., quadratic).</p>
<p>When there are no observations, what does the model believe? These are our priors with no likelihood.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this wasn't working...</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>m3<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quap</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>      W <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>Hm,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>      b <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">-</span> <span class="fu">list</span>(<span class="at">W=</span>W, <span class="at">H=</span>H)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="linear-prediction-adding-a-predictor" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="linear-prediction-adding-a-predictor"><span class="header-section-number">3.4</span> Linear Prediction: Adding a predictor</h2>
<p>We’ll now add a predictor to our model: weight. So we’ll look at how height covaries with weight (our predictor).</p>
<p>A scatter plot of weight by height (with ggplot):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d2, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We now have:</p>
<p><span class="math display">\[\begin{align}
h_i &amp;\sim Normal(\mu_i, \sigma) \hspace{35pt}likelihood \label{eq-likelihood} \\
\mu_i &amp;\sim \alpha + \beta(x_i - \bar{x}) \hspace{35pt}linear\;model \label{eq-linear} \\
\alpha &amp;\sim Normal(178, 20) \hspace{35pt}\beta \; prior \label{eq-alpha}\\
\beta &amp;\sim Normal(178, 20) \hspace{35pt}\mu \; prior \label{eq-mu}\\
\sigma &amp;\sim Uniform(0, 50) \hspace{35pt}\sigma \; prior \label{eq-sigma}
\end{align}\]</span></p>
<p>where the average of <span class="math inline">\(x\)</span> values is <span class="math inline">\(\bar{x}\)</span>. Our predictor variablle is <span class="math inline">\(x\)</span>, which is a list of measures of the same length as <span class="math inline">\(h\)</span>. We now define <span class="math inline">\(\mu\)</span> as a function of the values in <span class="math inline">\(x\)</span> in order to include our predictor, weight, in the model. <span class="math inline">\(\alpha\)</span> is our intercept, <span class="math inline">\(\beta\)</span> is our slope.</p>
</section>
<section id="polynomial-regression" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="polynomial-regression"><span class="header-section-number">3.5</span> Polynomial regression</h2>
</section>
<section id="solomon-kurz" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="solomon-kurz"><span class="header-section-number">3.6</span> Solomon Kurz</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.20.3). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:rethinking':

    LOO, stancode, WAIC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
</div>
<section id="fitting-a-model-with-brm" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="fitting-a-model-with-brm"><span class="header-section-number">3.6.1</span> Fitting a model with <code>brm()</code></h3>
<p>Instead of <code>statrethinking::map()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"fits/b04.01"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: height ~ 1 
   Data: d2 (Number of observations: 352) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept   154.60      0.41   153.80   155.43 1.00     2887     2156

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     7.77      0.30     7.22     8.38 1.00     3322     2196

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Or, if we want to use the 89% intervals used in the textbook:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.1</span>, <span class="at">prob =</span> .<span class="dv">89</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: height ~ 1 
   Data: d2 (Number of observations: 352) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Population-Level Effects: 
          Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
Intercept   154.60      0.41   153.95   155.24 1.00     2887     2156

Family Specific Parameters: 
      Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS
sigma     7.77      0.30     7.31     8.26 1.00     3322     2196

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<p>Now if we want very narrow priors (sd of 0.1!):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, <span class="at">family =</span> gaussian,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="fl">0.1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"fits/b04.02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see the chains actually look pretty good. Let’s look at the fixed effects to easily compare the estimates of the two models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(b4<span class="fl">.1</span>)<span class="sc">$</span>fixed <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"b4.1"</span>),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.2</span>)<span class="sc">$</span>fixed <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"b4.2"</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
  Estimate Est.Error `l-95% CI` `u-95% CI`  Rhat Bulk_ESS Tail_ESS model
     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
1     155.     0.411       154.       155.  1.00    2887.    2156. b4.1 
2     178.     0.101       178.       178.  1.00    3066.    2437. b4.2 </code></pre>
</div>
</div>
</section>
<section id="sampleing-from-a-brm-fit" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="sampleing-from-a-brm-fit"><span class="header-section-number">3.6.2</span> Sampleing from a <code>brm()</code> fit</h3>
<p>Instead of using the <code>vcov()</code> function from the <code>statrethinking</code> package (<code>brms</code> has a <code>vcov()</code> function but it only gives the first element in the matrix), we can get it after putting the HMC chains in a data frame (which we do with <code>as_draws_df()</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.1</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A draws_df: 6 iterations, 1 chains, and 4 variables
  b_Intercept sigma lprior  lp__
1         155   7.5   -8.5 -1227
2         155   7.0   -8.5 -1230
3         154   7.6   -8.5 -1226
4         154   8.0   -8.5 -1226
5         155   7.6   -8.5 -1226
6         155   7.4   -8.5 -1227
# ... hidden reserved variables {'.chain', '.iteration', '.draw'}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(post, b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Dropping 'draws_df' class as required metadata was removed.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             b_Intercept        sigma
b_Intercept  0.168810743 -0.000740092
sigma       -0.000740092  0.087416426</code></pre>
</div>
</div>
</section>
</section>
<section id="practice" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="practice"><span class="header-section-number">3.7</span> Practice</h2>
<section id="e1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="e1">E1</h3>
<blockquote class="blockquote">
<p>In the model definition below, which line is the likelihood? <span class="math display">\[\begin{align}
y_i &amp;\sim Normal(\mu,\sigma) \label{ex-e1a} \\
\mu &amp;\sim Normal(0,10) \label{ex-e1b} \\
\sigma &amp;\sim Exponential(1) \label{ex-e1c}
\end{align}\]</span></p>
</blockquote>
<p><span class="math inline">\(\ref{ex-e1a}\)</span> is the likelihood (<span class="math inline">\(\ref{ex-e1b}\)</span> is the prior for <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\ref{ex-e1c}\)</span> for <span class="math inline">\(\sigma\)</span>)</p>
</section>
<section id="e2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="e2">E2</h3>
<blockquote class="blockquote">
<p>In the model definition just above, how many parameters are in the posterior distribution?</p>
</blockquote>
<p>There are two parameters in the posterior distribution: <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\sigma\)</span></p>
</section>
<section id="e3" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="e3">E3</h3>
<blockquote class="blockquote">
<p>Using the model definition above, write down the appropriate form of Bayes’ theorem that includes the proper likelihood and priors.</p>
</blockquote>
<p>Bayes’ theorem is:</p>
<p><span class="math display">\[\begin{equation}
P(A|B) = \frac{P(B|A)P(A)}{P(B)}
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(A\)</span> is our priors and <span class="math inline">\(B\)</span> is the posterior, i.e., observed data (<span class="math inline">\(y\)</span>) I’m guessing? And so…</p>
<p><span class="math display">\[\begin{equation}
P(\mu,\sigma|y) = \frac{P(y|\mu,\sigma)P(\mu)P(\sigma)}{P(y)}
\end{equation}\]</span></p>
<p>Okay I really don’t know…I guess we add in the model parameter definitions?</p>
</section>
<section id="e4" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="e4">E4</h3>
<blockquote class="blockquote">
<p>In the model definition below, which line is the linear model? <span class="math display">\[\begin{align}
y_i &amp;\sim Normal(\mu,\sigma) \label{ex-e4a} \\
\mu &amp;= \alpha + \beta x_i \label{ex-e4b} \\
\alpha &amp;\sim Normal(0,10) \label{ex-e4c} \\
\beta &amp;\sim Normal(0,1) \label{ex-e4d} \\
\sigma &amp;\sim Exponential(2) \label{ex-e4e}
\end{align}\]</span></p>
</blockquote>
<p><span class="math inline">\(\ref{ex-e4b}\)</span> is the linear model. is the likelihood, the prior for <span class="math inline">\(\alpha\)</span> (intercept), the prior for <span class="math inline">\(\beta\)</span> (slope), and the prior for sigma (sd).</p>
</section>
<section id="e5" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="e5">E5</h3>
<blockquote class="blockquote">
<p>In the model definition just above, how many parameters are in the posterior distribution?</p>
</blockquote>
<p>The posterior distribution has the parameters:</p>
<ul>
<li><span class="math inline">\(\sigma\)</span>: standard deviation</li>
<li><span class="math inline">\(\alpha\)</span>: intercept</li>
<li><span class="math inline">\(\beta\)</span>: slope</li>
</ul>
</section>
<section id="m1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="m1">M1</h3>
<blockquote class="blockquote">
<p>For the model definition below, simulate observed y values from the prior (not the posterior). <span class="math display">\[\begin{align}
y_i &amp;\sim Normal(\mu,\sigma) \label{ex-m1a} \\
\mu &amp;\sim Normal(0,10) \label{ex-m1b} \\
\sigma &amp;\sim Exponential(1) \label{ex-m1c}
\end{align}\]</span></p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># same as R chunk 4.14</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="fl">1e4</span>, <span class="dv">1</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate prior predictive values</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And our prior predictive with ggplot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>,       <span class="at">sd  =</span> <span class="dv">10</span>),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">sample_sigma =</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd  =</span> sample_sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span><span class="st">"for"</span><span class="sc">~</span><span class="fu">italic</span>(h[i])),</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="sampling-from-the-posterior" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="sampling-from-the-posterior"><span class="header-section-number">3.7.1</span> Sampling from the posterior</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.15</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( <span class="fl">1e4</span> , <span class="dv">178</span> , <span class="dv">100</span> ) </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( <span class="fl">1e4</span> , sample_mu , sample_sigma ) </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( prior_h )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.16</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">160</span> , <span class="at">length.out=</span><span class="dv">100</span> ) </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">7</span> , <span class="at">to=</span><span class="dv">9</span> , <span class="at">length.out=</span><span class="dv">100</span> ) </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( <span class="at">mu=</span>mu.list , <span class="at">sigma=</span>sigma.list ) </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post) , <span class="cf">function</span>(i) </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>( <span class="fu">dnorm</span>( d2<span class="sc">$</span>height , post<span class="sc">$</span>mu[i] , post<span class="sc">$</span>sigma[i] , <span class="at">log=</span><span class="cn">TRUE</span> ) ) ) </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prod <span class="ot">&lt;-</span> post<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span> ) <span class="sc">+</span> <span class="fu">dunif</span>( post<span class="sc">$</span>sigma , <span class="dv">0</span> , <span class="dv">50</span> , <span class="cn">TRUE</span> ) </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>( post<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post<span class="sc">$</span>prod) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.17</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>sample.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post) , <span class="at">size=</span><span class="fl">1e4</span> , <span class="at">replace=</span><span class="cn">TRUE</span> , <span class="at">prob=</span>post<span class="sc">$</span>prob ) </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>sample.mu <span class="ot">&lt;-</span> post<span class="sc">$</span>mu[ sample.rows ] </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>sample.sigma <span class="ot">&lt;-</span> post<span class="sc">$</span>sigma[ sample.rows ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.21</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample_mu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.21</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample_sigma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="04-geometric_models_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="m2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="m2">M2</h3>
<blockquote class="blockquote">
<p>Translate the model just above into a quap formula.</p>
</blockquote>
<p>Do this as in R chunk 4.26:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>flist <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(height <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma) , </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>        mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span> , <span class="dv">10</span>) , </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">0</span> , <span class="dv">1</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/03-sampling.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Sampling the Imaginary</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb58" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Geocentric Models"</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Chapter 4 in McElreath (2020)"</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Daniela Palleschi"</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>My notes for this chapter are a bit muddled, I did a mix of reading the textbook and watching the YouTube video. Unfortuantely the YouTube video doesn't map onto the chapter very transparently and even has code that isn't in the current textbook version, so some concepts might be repeated/out of order.</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resources {.unnumbered}</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">YouTube lecture (2023): Geocentric Models</span><span class="co">](https://www.youtube.com/watch?v=tNOu-SEacNU&amp;list=PLDcUM9US4XdPz-KxHM4XHt7uUVGWWVSus&amp;index=4&amp;t=1208s)</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Solomon Kurz: <span class="co">[</span><span class="ot">Linear models</span><span class="co">](https://bookdown.org/content/3890/linear-models.html)</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">## Set-up {.unnumbered}</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  rethinking,</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  tidyverse,</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>  janitor,</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>  knitr,</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>  kableExtra</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Permission to be confused {.unnumbered}</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>From ~ 20 minute mark from the YouTue video</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>you don't need to understand everything all at once</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>math, concepts, code, installation problems etc.</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>it's important to keep some *flow*</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>keep moving forward despite the resistance of confusion/struggle</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>things shouldn't be too hard, because then you stop moving</span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>if it's too easy, you don't feel any resistance</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>feeling confused means you're paying attention :)</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Geocentric Model {.unnumbered}</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>planets have been observed to have a zig-zag orbit from the perspective of Earth</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Geocentric model/Telomeric model</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>used to predict the pattern of planets orbit, with the prior of Earth at the centre of the solar system</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the geocentric model was very accurate</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>however, the orbits of the planets are elliptical and orbit around the *sun*, not the earth</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>so models built on inaccurate assumptions can still be very accurate in their predictions</span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>the orbits of the planets are embedded witin each other (based on their proximity to the sun), so there is a point when two planets' orbits are closer to each other, i.e., when their orbits have them closer together</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>which is how the perception of Mars' zig-zag orbit (and other planets, but it's more stricking for Mars)</span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>in 1809: Bayesian argument for normal error and least-squares estimation from Gauss</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Geocentric**: describes association, makes predictions, but mechanisticalistically wrong</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>the problem is not the model itself, rather some external causal model we project onto the model</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>geocentric models are still extremely useful, what's wrong is believing they're *true* reflections of e.g., the solar system</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>there's also nothing wrong with linear regression itself, as long as we don't believe they're an accurate mechanistic model of the system we're studying</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Gaussian**: abstracts from generative error model, replaces with normal distribution, mechanistically silent</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>usually a pretty good approximation of associations</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>we will be using gaussian error models</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>useful when handled *with care*</span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>many special cases: ANOVA, ANCOVA, t-test, etc.</span>
<span id="cb58-71"><a href="#cb58-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-72"><a href="#cb58-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why normal distributions are normal</span></span>
<span id="cb58-73"><a href="#cb58-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-74"><a href="#cb58-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normal by multiplication</span></span>
<span id="cb58-75"><a href="#cb58-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-76"><a href="#cb58-76" aria-hidden="true" tabindex="-1"></a><span class="fu">### Normal by log-multiplication</span></span>
<span id="cb58-77"><a href="#cb58-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-78"><a href="#cb58-78" aria-hidden="true" tabindex="-1"></a><span class="fu">### Using Gaussian distributions</span></span>
<span id="cb58-79"><a href="#cb58-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-80"><a href="#cb58-80" aria-hidden="true" tabindex="-1"></a><span class="fu">## A language for describing models</span></span>
<span id="cb58-81"><a href="#cb58-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-82"><a href="#cb58-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Gaussian model of height</span></span>
<span id="cb58-83"><a href="#cb58-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-86"><a href="#cb58-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-87"><a href="#cb58-87" aria-hidden="true" tabindex="-1"></a><span class="co"># load Howell1 data from rethinking package</span></span>
<span id="cb58-88"><a href="#cb58-88" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1) </span>
<span id="cb58-89"><a href="#cb58-89" aria-hidden="true" tabindex="-1"></a>df_weight <span class="ot">&lt;-</span> Howell1</span>
<span id="cb58-90"><a href="#cb58-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-91"><a href="#cb58-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-94"><a href="#cb58-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-95"><a href="#cb58-95" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_weight)</span>
<span id="cb58-96"><a href="#cb58-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-97"><a href="#cb58-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-100"><a href="#cb58-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-101"><a href="#cb58-101" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_weight)</span>
<span id="cb58-102"><a href="#cb58-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-103"><a href="#cb58-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-104"><a href="#cb58-104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>age ranges from babies to seniors</span>
<span id="cb58-105"><a href="#cb58-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>sex as binary</span>
<span id="cb58-106"><a href="#cb58-106" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>height in cm</span>
<span id="cb58-107"><a href="#cb58-107" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>weight in kg</span>
<span id="cb58-108"><a href="#cb58-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-109"><a href="#cb58-109" aria-hidden="true" tabindex="-1"></a><span class="in">`precis()`</span> function from rethinking package:</span>
<span id="cb58-110"><a href="#cb58-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-113"><a href="#cb58-113" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-114"><a href="#cb58-114" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(df_weight) <span class="sc">|&gt;</span> </span>
<span id="cb58-115"><a href="#cb58-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-116"><a href="#cb58-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb58-117"><a href="#cb58-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span>
<span id="cb58-118"><a href="#cb58-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-119"><a href="#cb58-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-120"><a href="#cb58-120" aria-hidden="true" tabindex="-1"></a>To define heights as normally distributed, we write \ref{eq-height-gauss}, where $i$ stands for index. \ref{eq-height-gauss} is saying that all the golem (i.e., our model) knows about each observed height measurement is defined by the same normal distribution with mean $\mu$ and standard deviation $\sigma$.</span>
<span id="cb58-121"><a href="#cb58-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-122"><a href="#cb58-122" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb58-123"><a href="#cb58-123" aria-hidden="true" tabindex="-1"></a>h_i \sim Normal(\mu, \sigma) \label{eq-height-gauss} <span class="sc">\\</span></span>
<span id="cb58-124"><a href="#cb58-124" aria-hidden="true" tabindex="-1"></a>\mu \sim Normal(178, 20) \label{eq-height-prior-mu} <span class="sc">\\</span></span>
<span id="cb58-125"><a href="#cb58-125" aria-hidden="true" tabindex="-1"></a>\sigma \sim Uniform(0, 50) \label{eq-height-prior-sigma}</span>
<span id="cb58-126"><a href="#cb58-126" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb58-127"><a href="#cb58-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-128"><a href="#cb58-128" aria-hidden="true" tabindex="-1"></a>\ref{eq-height-prior-mu} represents our *prior* for $\mu$, where our assumed mean is 178 cm (because Richard McElreath is 178cm tall), with a 95\% probability between +/- 40cm (because if the SD is 20cm, 20 x 1.96 is approximately 20 x 2).</span>
<span id="cb58-129"><a href="#cb58-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-132"><a href="#cb58-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-133"><a href="#cb58-133" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.10</span></span>
<span id="cb58-134"><a href="#cb58-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-135"><a href="#cb58-135" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data for adults only</span></span>
<span id="cb58-136"><a href="#cb58-136" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> df_weight <span class="sc">|&gt;</span> <span class="fu">filter</span>(age <span class="sc">&gt;</span> <span class="dv">18</span>)</span>
<span id="cb58-137"><a href="#cb58-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-138"><a href="#cb58-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-139"><a href="#cb58-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-140"><a href="#cb58-140" aria-hidden="true" tabindex="-1"></a>We can plot our priors:</span>
<span id="cb58-141"><a href="#cb58-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-144"><a href="#cb58-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-145"><a href="#cb58-145" aria-hidden="true" tabindex="-1"></a><span class="co"># R code chunk 4.12</span></span>
<span id="cb58-146"><a href="#cb58-146" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="dv">178</span>, <span class="dv">20</span>), <span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>)</span>
<span id="cb58-147"><a href="#cb58-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-148"><a href="#cb58-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-149"><a href="#cb58-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-150"><a href="#cb58-150" aria-hidden="true" tabindex="-1"></a>Or, with ggplot (from <span class="co">[</span><span class="ot">Solomon Kurz</span><span class="co">](https://bookdown.org/content/3890/linear-models.html#a-gaussian-model-of-height)</span>):</span>
<span id="cb58-151"><a href="#cb58-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-154"><a href="#cb58-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-155"><a href="#cb58-155" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">250</span>, <span class="at">by =</span> .<span class="dv">1</span>)), </span>
<span id="cb58-156"><a href="#cb58-156" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>))) <span class="sc">+</span></span>
<span id="cb58-157"><a href="#cb58-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb58-158"><a href="#cb58-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"density"</span>)</span>
<span id="cb58-159"><a href="#cb58-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-160"><a href="#cb58-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-161"><a href="#cb58-161" aria-hidden="true" tabindex="-1"></a>We can also view our prior for $\sigma$, which is a flat (uniform) prior:</span>
<span id="cb58-162"><a href="#cb58-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-165"><a href="#cb58-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-166"><a href="#cb58-166" aria-hidden="true" tabindex="-1"></a><span class="co"># R code chunk 4.13</span></span>
<span id="cb58-167"><a href="#cb58-167" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dunif</span>(x, <span class="dv">0</span>, <span class="dv">50</span>), <span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>)</span>
<span id="cb58-168"><a href="#cb58-168" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-169"><a href="#cb58-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-170"><a href="#cb58-170" aria-hidden="true" tabindex="-1"></a>And with ggplot (from <span class="co">[</span><span class="ot">Solomon Kurz</span><span class="co">](https://bookdown.org/content/3890/linear-models.html#a-gaussian-model-of-height)</span>):</span>
<span id="cb58-171"><a href="#cb58-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-174"><a href="#cb58-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-175"><a href="#cb58-175" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-176"><a href="#cb58-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-177"><a href="#cb58-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dunif</span>(x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>))) <span class="sc">+</span></span>
<span id="cb58-178"><a href="#cb58-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb58-179"><a href="#cb58-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb58-180"><a href="#cb58-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-181"><a href="#cb58-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-182"><a href="#cb58-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-183"><a href="#cb58-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-184"><a href="#cb58-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-185"><a href="#cb58-185" aria-hidden="true" tabindex="-1"></a>A standard deviation must be positiion, and so we've bound it at zero. Picking the upperbound is another question: in our case a sd of 50cm would imply that 95\% of individual heights lie within 100cm of the average height (again, because SD * 1.96), which is a very large range.</span>
<span id="cb58-186"><a href="#cb58-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-187"><a href="#cb58-187" aria-hidden="true" tabindex="-1"></a>Now it's time for a ~prior predictive~ simulation, for which we need our chosen priors for $h, \mu,$ and  $\sigma$, which imply a joint prior distribution of individual heights.</span>
<span id="cb58-188"><a href="#cb58-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-189"><a href="#cb58-189" aria-hidden="true" tabindex="-1"></a>Let's quickly simiulate heights by sampling from our prior. We can process priors just like posteriors, because every posterior is also potentially a prior for a subsequent analysis.</span>
<span id="cb58-190"><a href="#cb58-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-193"><a href="#cb58-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-194"><a href="#cb58-194" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.14</span></span>
<span id="cb58-195"><a href="#cb58-195" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb58-196"><a href="#cb58-196" aria-hidden="true" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb58-197"><a href="#cb58-197" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb58-198"><a href="#cb58-198" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span>
<span id="cb58-199"><a href="#cb58-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-200"><a href="#cb58-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-201"><a href="#cb58-201" aria-hidden="true" tabindex="-1"></a>And sampling from both $\mu$ and $\sigma$ priors to get a prior probability of heights:</span>
<span id="cb58-202"><a href="#cb58-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-205"><a href="#cb58-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-206"><a href="#cb58-206" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb58-207"><a href="#cb58-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-208"><a href="#cb58-208" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb58-209"><a href="#cb58-209" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">178</span>,       <span class="at">sd  =</span> <span class="dv">20</span>),</span>
<span id="cb58-210"><a href="#cb58-210" aria-hidden="true" tabindex="-1"></a>       <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n, <span class="at">min  =</span> <span class="dv">0</span>,         <span class="at">max =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-211"><a href="#cb58-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd  =</span> sample_sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-212"><a href="#cb58-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-213"><a href="#cb58-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb58-214"><a href="#cb58-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb58-215"><a href="#cb58-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb58-216"><a href="#cb58-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span><span class="st">"for"</span><span class="sc">~</span><span class="fu">italic</span>(h[i])),</span>
<span id="cb58-217"><a href="#cb58-217" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb58-218"><a href="#cb58-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-219"><a href="#cb58-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-220"><a href="#cb58-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-221"><a href="#cb58-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-222"><a href="#cb58-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-223"><a href="#cb58-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-224"><a href="#cb58-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-225"><a href="#cb58-225" aria-hidden="true" tabindex="-1"></a><span class="fu">### Finding the posterior distribution with `quap`</span></span>
<span id="cb58-226"><a href="#cb58-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-229"><a href="#cb58-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-230"><a href="#cb58-230" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 2.23</span></span>
<span id="cb58-231"><a href="#cb58-231" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">sample</span>( d2<span class="sc">$</span>height , <span class="at">size=</span><span class="dv">20</span> )</span>
<span id="cb58-232"><a href="#cb58-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-233"><a href="#cb58-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-234"><a href="#cb58-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-237"><a href="#cb58-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-238"><a href="#cb58-238" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.24</span></span>
<span id="cb58-239"><a href="#cb58-239" aria-hidden="true" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">170</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb58-240"><a href="#cb58-240" aria-hidden="true" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">4</span> , <span class="at">to=</span><span class="dv">20</span> , <span class="at">length.out=</span><span class="dv">200</span> ) </span>
<span id="cb58-241"><a href="#cb58-241" aria-hidden="true" tabindex="-1"></a>post2 <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( <span class="at">mu=</span>mu.list , <span class="at">sigma=</span>sigma.list ) </span>
<span id="cb58-242"><a href="#cb58-242" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="cf">function</span>(i) <span class="fu">sum</span>( <span class="fu">dnorm</span>( d3 , <span class="at">mean=</span>post2<span class="sc">$</span>mu[i] , <span class="at">sd=</span>post2<span class="sc">$</span>sigma[i] , <span class="at">log=</span><span class="cn">TRUE</span> ) ) )</span>
<span id="cb58-243"><a href="#cb58-243" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>prod <span class="ot">&lt;-</span> post2<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post2<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span> ) <span class="sc">+</span> <span class="fu">dunif</span>( post2<span class="sc">$</span>sigma , <span class="dv">0</span> , <span class="dv">50</span> , <span class="cn">TRUE</span> ) </span>
<span id="cb58-244"><a href="#cb58-244" aria-hidden="true" tabindex="-1"></a>post2<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>( post2<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post2<span class="sc">$</span>prod) )</span>
<span id="cb58-245"><a href="#cb58-245" aria-hidden="true" tabindex="-1"></a>sample2.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post2) , <span class="at">size=</span><span class="fl">1e4</span> , <span class="at">replace=</span><span class="cn">TRUE</span> , <span class="at">prob=</span>post2<span class="sc">$</span>prob ) </span>
<span id="cb58-246"><a href="#cb58-246" aria-hidden="true" tabindex="-1"></a>sample2.mu <span class="ot">&lt;-</span> post2<span class="sc">$</span>mu[ sample2.rows ] </span>
<span id="cb58-247"><a href="#cb58-247" aria-hidden="true" tabindex="-1"></a>sample2.sigma <span class="ot">&lt;-</span> post2<span class="sc">$</span>sigma[ sample2.rows ]</span>
<span id="cb58-248"><a href="#cb58-248" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( sample2.mu , sample2.sigma , <span class="at">cex=</span><span class="fl">0.5</span> , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.1</span>) , <span class="at">xlab=</span><span class="st">"mu"</span> , <span class="at">ylab=</span><span class="st">"sigma"</span> , <span class="at">pch=</span><span class="dv">16</span> )</span>
<span id="cb58-249"><a href="#cb58-249" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-250"><a href="#cb58-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-253"><a href="#cb58-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-254"><a href="#cb58-254" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.26</span></span>
<span id="cb58-255"><a href="#cb58-255" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb58-256"><a href="#cb58-256" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb58-257"><a href="#cb58-257" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> d[d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span> , ]</span>
<span id="cb58-258"><a href="#cb58-258" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-259"><a href="#cb58-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-260"><a href="#cb58-260" aria-hidden="true" tabindex="-1"></a>And define our model and place it into an <span class="in">`alist`</span>.</span>
<span id="cb58-261"><a href="#cb58-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-264"><a href="#cb58-264" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-265"><a href="#cb58-265" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.27</span></span>
<span id="cb58-266"><a href="#cb58-266" aria-hidden="true" tabindex="-1"></a>flist <span class="ot">&lt;-</span></span>
<span id="cb58-267"><a href="#cb58-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(height <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma) , </span>
<span id="cb58-268"><a href="#cb58-268" aria-hidden="true" tabindex="-1"></a>        mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span> , <span class="dv">20</span>) , </span>
<span id="cb58-269"><a href="#cb58-269" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span> , <span class="dv">50</span>)</span>
<span id="cb58-270"><a href="#cb58-270" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb58-271"><a href="#cb58-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-272"><a href="#cb58-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-273"><a href="#cb58-273" aria-hidden="true" tabindex="-1"></a>Fit a model to the data in <span class="in">`d2`</span>.</span>
<span id="cb58-274"><a href="#cb58-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-277"><a href="#cb58-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-278"><a href="#cb58-278" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.28</span></span>
<span id="cb58-279"><a href="#cb58-279" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(flist, <span class="at">data =</span> d2)</span>
<span id="cb58-280"><a href="#cb58-280" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-281"><a href="#cb58-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-282"><a href="#cb58-282" aria-hidden="true" tabindex="-1"></a>Take a look.</span>
<span id="cb58-283"><a href="#cb58-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-286"><a href="#cb58-286" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-287"><a href="#cb58-287" aria-hidden="true" tabindex="-1"></a><span class="co"># R code 4.29</span></span>
<span id="cb58-288"><a href="#cb58-288" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.1</span>)</span>
<span id="cb58-289"><a href="#cb58-289" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-290"><a href="#cb58-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-291"><a href="#cb58-291" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulate weights</span></span>
<span id="cb58-292"><a href="#cb58-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-293"><a href="#cb58-293" aria-hidden="true" tabindex="-1"></a>From the GitHub script 03_howell etc.</span>
<span id="cb58-294"><a href="#cb58-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-297"><a href="#cb58-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-298"><a href="#cb58-298" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb58-299"><a href="#cb58-299" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> Howell1</span>
<span id="cb58-300"><a href="#cb58-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-301"><a href="#cb58-301" aria-hidden="true" tabindex="-1"></a><span class="co"># draw data</span></span>
<span id="cb58-302"><a href="#cb58-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-303"><a href="#cb58-303" aria-hidden="true" tabindex="-1"></a><span class="fu">blank</span>(<span class="at">bty=</span><span class="st">"n"</span>)</span>
<span id="cb58-304"><a href="#cb58-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-305"><a href="#cb58-305" aria-hidden="true" tabindex="-1"></a>col2 <span class="ot">&lt;-</span> <span class="fu">col.alpha</span>(<span class="dv">2</span>,<span class="fl">0.8</span>)</span>
<span id="cb58-306"><a href="#cb58-306" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>height , d<span class="sc">$</span>weight , <span class="at">col=</span>col2 , <span class="at">lwd=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">1.2</span> , <span class="at">xlab=</span><span class="st">"height (cm)"</span> , <span class="at">ylab=</span><span class="st">"weight (kg)"</span> )</span>
<span id="cb58-307"><a href="#cb58-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-308"><a href="#cb58-308" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d[ d<span class="sc">$</span>age<span class="sc">&gt;=</span><span class="dv">18</span> , ]</span>
<span id="cb58-309"><a href="#cb58-309" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d<span class="sc">$</span>height , d<span class="sc">$</span>weight , <span class="at">col=</span>col2 , <span class="at">lwd=</span><span class="dv">3</span> , <span class="at">cex=</span><span class="fl">1.2</span> , <span class="at">xlab=</span><span class="st">"height (cm)"</span> , <span class="at">ylab=</span><span class="st">"weight (kg)"</span> )</span>
<span id="cb58-310"><a href="#cb58-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-311"><a href="#cb58-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-312"><a href="#cb58-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-313"><a href="#cb58-313" aria-hidden="true" tabindex="-1"></a><span class="fu">### Describing models</span></span>
<span id="cb58-314"><a href="#cb58-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-315"><a href="#cb58-315" aria-hidden="true" tabindex="-1"></a>(video c. 31:00)</span>
<span id="cb58-316"><a href="#cb58-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-317"><a href="#cb58-317" aria-hidden="true" tabindex="-1"></a>Conventional statistical model notaton:</span>
<span id="cb58-318"><a href="#cb58-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-319"><a href="#cb58-319" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>list the variables in the model</span>
<span id="cb58-320"><a href="#cb58-320" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>define each variable as a deterministic or distributional function of the other variables</span>
<span id="cb58-321"><a href="#cb58-321" aria-hidden="true" tabindex="-1"></a><span class="ss">  + </span>where does each variable get its value?</span>
<span id="cb58-322"><a href="#cb58-322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-325"><a href="#cb58-325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-326"><a href="#cb58-326" aria-hidden="true" tabindex="-1"></a><span class="co"># function to simulate weights of individuals from height </span></span>
<span id="cb58-327"><a href="#cb58-327" aria-hidden="true" tabindex="-1"></a>sim_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(H,b,sd) {</span>
<span id="cb58-328"><a href="#cb58-328" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(H), <span class="dv">0</span>, sd)</span>
<span id="cb58-329"><a href="#cb58-329" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> b<span class="sc">*</span>H <span class="sc">+</span> U</span>
<span id="cb58-330"><a href="#cb58-330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(W)</span>
<span id="cb58-331"><a href="#cb58-331" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-332"><a href="#cb58-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-333"><a href="#cb58-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-334"><a href="#cb58-334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>this is a function of unobserved U, which has normal error</span>
<span id="cb58-335"><a href="#cb58-335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>where W is a deterministic function of H and U together</span>
<span id="cb58-336"><a href="#cb58-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-337"><a href="#cb58-337" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>this can be re-written with standard statistical notation as followed:</span>
<span id="cb58-338"><a href="#cb58-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-339"><a href="#cb58-339" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb58-340"><a href="#cb58-340" aria-hidden="true" tabindex="-1"></a>W_i &amp;= \beta H_i + U_i \label{eq-W} <span class="sc">\\</span></span>
<span id="cb58-341"><a href="#cb58-341" aria-hidden="true" tabindex="-1"></a>U_i &amp;\sim Normal(0,\sigma) \label{eq-U} <span class="sc">\\</span></span>
<span id="cb58-342"><a href="#cb58-342" aria-hidden="true" tabindex="-1"></a>H_i &amp;\sim Uniform(130,170) \label{eq-H}</span>
<span id="cb58-343"><a href="#cb58-343" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb58-344"><a href="#cb58-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-345"><a href="#cb58-345" aria-hidden="true" tabindex="-1"></a>Each of these is mirrored in a line of code. Along the left of the equations are the variables, along the right are their definitions. The subscripts indicate individuals (indexing).</span>
<span id="cb58-346"><a href="#cb58-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-347"><a href="#cb58-347" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$=$ indicates a **deterministic** relationship</span>
<span id="cb58-348"><a href="#cb58-348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\sim$ indicates a **distributional** relationship</span>
<span id="cb58-349"><a href="#cb58-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-350"><a href="#cb58-350" aria-hidden="true" tabindex="-1"></a>Equation \ref{eq-W} is the equation for expected weight. Once we know the values to the right of this equation we can assign values to W. Equation \ref{eq-U} represents Gaussian error with standard deviation sigma.</span>
<span id="cb58-351"><a href="#cb58-351" aria-hidden="true" tabindex="-1"></a>Equation \ref{eq-H} defines height as uniformly distributed from 130cm to 170cm. These are all defined in the code chunk above, but written in the opposite order. In the code it's written in order of execution, but the statistical conventional notation sometimes has arbitrary order, but conventionally is stated in the opposite direction as the code is written because you start with the most general definition (\ref{eq-W}) which depends on the other variables, and then you see how the variables W depends upon are defined. There's a hierarchy that makes sense.</span>
<span id="cb58-352"><a href="#cb58-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-353"><a href="#cb58-353" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimator</span></span>
<span id="cb58-354"><a href="#cb58-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-355"><a href="#cb58-355" aria-hidden="true" tabindex="-1"></a>We want to estimate how the average weight changes with height, i.e., how the average weight changes with height.</span>
<span id="cb58-356"><a href="#cb58-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-357"><a href="#cb58-357" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb58-358"><a href="#cb58-358" aria-hidden="true" tabindex="-1"></a>E(W_i|H_i) = \alpha + \beta H_i</span>
<span id="cb58-359"><a href="#cb58-359" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb58-360"><a href="#cb58-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-361"><a href="#cb58-361" aria-hidden="true" tabindex="-1"></a>Where $E(W_i|H_i)$ is the average weight conditional on height, $\alpha$ is the intercept and $\beta$ is our slope. So each height has a different average weight.</span>
<span id="cb58-362"><a href="#cb58-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-363"><a href="#cb58-363" aria-hidden="true" tabindex="-1"></a><span class="fu">### Posterior distribution</span></span>
<span id="cb58-364"><a href="#cb58-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-365"><a href="#cb58-365" aria-hidden="true" tabindex="-1"></a>Good Bayesians estimate a posterior. The equation below is the same as that for when we tossed the globe, but we just have more unknowns now.</span>
<span id="cb58-366"><a href="#cb58-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-367"><a href="#cb58-367" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb58-368"><a href="#cb58-368" aria-hidden="true" tabindex="-1"></a>Pr(\alpha, \beta, \sigma|H_i, W_i) = \frac</span>
<span id="cb58-369"><a href="#cb58-369" aria-hidden="true" tabindex="-1"></a>{Pr(W_i|H_i, \alpha, \beta, \sigma)Pr(\alpha, \beta, \sigma)}</span>
<span id="cb58-370"><a href="#cb58-370" aria-hidden="true" tabindex="-1"></a>{Z}</span>
<span id="cb58-371"><a href="#cb58-371" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb58-372"><a href="#cb58-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-373"><a href="#cb58-373" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Pr(\alpha, \beta, \sigma|H_i, W_i)$ is the posterior probability of a specific regression line, which is defined by \alpha, \beta, and \sigma (unobserved variables). H and W are our *observed* data, we don't need a posterior distribution for them, they're observed (the likelihood).</span>
<span id="cb58-374"><a href="#cb58-374" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Pr(W_i|H_i, \alpha, \beta, \sigma)$: garden of forking data</span>
<span id="cb58-375"><a href="#cb58-375" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Pr(\alpha, \beta, \sigma)$: our priors</span>
<span id="cb58-376"><a href="#cb58-376" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Z$: a normalising constant that we don't need to pay too much attention to, it ensures the lefthand side of the equation is a proper probability</span>
<span id="cb58-377"><a href="#cb58-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-378"><a href="#cb58-378" aria-hidden="true" tabindex="-1"></a>W is normally distributed with mean that is a a linear function of H.</span>
<span id="cb58-379"><a href="#cb58-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-380"><a href="#cb58-380" aria-hidden="true" tabindex="-1"></a>These models are typically written as below:</span>
<span id="cb58-381"><a href="#cb58-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-382"><a href="#cb58-382" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb58-383"><a href="#cb58-383" aria-hidden="true" tabindex="-1"></a>W_i &amp;= Normal(\mu_i, \sigma) <span class="sc">\\</span></span>
<span id="cb58-384"><a href="#cb58-384" aria-hidden="true" tabindex="-1"></a>\mu_i &amp;\sim \alpha + \beta H_i</span>
<span id="cb58-385"><a href="#cb58-385" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb58-386"><a href="#cb58-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-387"><a href="#cb58-387" aria-hidden="true" tabindex="-1"></a><span class="fu">### Grid approximat posterior</span></span>
<span id="cb58-388"><a href="#cb58-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-389"><a href="#cb58-389" aria-hidden="true" tabindex="-1"></a>All posterior distributions begin with a single observations. There's no minimum number of observations in Bayesian inference.</span>
<span id="cb58-390"><a href="#cb58-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-391"><a href="#cb58-391" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quardratic approximation</span></span>
<span id="cb58-392"><a href="#cb58-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-393"><a href="#cb58-393" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>we'll approximate the posterior distribution as a multivariate Gaussian distribution. We can do that because posterior distributions are typically multivariate Gaussian distributions if there are enough observations. A tool that does this for us is called <span class="in">`quap()`</span> in the <span class="in">`statrethinking`</span> package.</span>
<span id="cb58-394"><a href="#cb58-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-395"><a href="#cb58-395" aria-hidden="true" tabindex="-1"></a>The Gaussian distribution is quadratic, and in the log-space the Gaussian distribution is a perfect parabola (i.e., quadratic).</span>
<span id="cb58-396"><a href="#cb58-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-397"><a href="#cb58-397" aria-hidden="true" tabindex="-1"></a>When there are no observations, what does the model believe? These are our priors with no likelihood.</span>
<span id="cb58-398"><a href="#cb58-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-401"><a href="#cb58-401" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-402"><a href="#cb58-402" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb58-403"><a href="#cb58-403" aria-hidden="true" tabindex="-1"></a><span class="co"># this wasn't working...</span></span>
<span id="cb58-404"><a href="#cb58-404" aria-hidden="true" tabindex="-1"></a>m3<span class="fl">.1</span> <span class="ot">&lt;-</span></span>
<span id="cb58-405"><a href="#cb58-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quap</span>(</span>
<span id="cb58-406"><a href="#cb58-406" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb58-407"><a href="#cb58-407" aria-hidden="true" tabindex="-1"></a>      W <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb58-408"><a href="#cb58-408" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>Hm,</span>
<span id="cb58-409"><a href="#cb58-409" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>),</span>
<span id="cb58-410"><a href="#cb58-410" aria-hidden="true" tabindex="-1"></a>      b <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb58-411"><a href="#cb58-411" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb58-412"><a href="#cb58-412" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb58-413"><a href="#cb58-413" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">-</span> <span class="fu">list</span>(<span class="at">W=</span>W, <span class="at">H=</span>H)</span>
<span id="cb58-414"><a href="#cb58-414" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-415"><a href="#cb58-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-416"><a href="#cb58-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-417"><a href="#cb58-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-418"><a href="#cb58-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linear Prediction: Adding a predictor</span></span>
<span id="cb58-419"><a href="#cb58-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-420"><a href="#cb58-420" aria-hidden="true" tabindex="-1"></a>We'll now add a predictor to our model: weight. So we'll look at how height covaries with weight (our predictor).</span>
<span id="cb58-421"><a href="#cb58-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-422"><a href="#cb58-422" aria-hidden="true" tabindex="-1"></a>A scatter plot of weight by height (with ggplot):</span>
<span id="cb58-423"><a href="#cb58-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-426"><a href="#cb58-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-427"><a href="#cb58-427" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d2, </span>
<span id="cb58-428"><a href="#cb58-428" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb58-429"><a href="#cb58-429" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-430"><a href="#cb58-430" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb58-431"><a href="#cb58-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-432"><a href="#cb58-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-433"><a href="#cb58-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-434"><a href="#cb58-434" aria-hidden="true" tabindex="-1"></a>We now have:</span>
<span id="cb58-435"><a href="#cb58-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-436"><a href="#cb58-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-437"><a href="#cb58-437" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb58-438"><a href="#cb58-438" aria-hidden="true" tabindex="-1"></a>h_i &amp;\sim Normal(\mu_i, \sigma) \hspace{35pt}likelihood \label{eq-likelihood} <span class="sc">\\</span></span>
<span id="cb58-439"><a href="#cb58-439" aria-hidden="true" tabindex="-1"></a>\mu_i &amp;\sim \alpha + \beta(x_i - \bar{x}) \hspace{35pt}linear\;model \label{eq-linear} <span class="sc">\\</span></span>
<span id="cb58-440"><a href="#cb58-440" aria-hidden="true" tabindex="-1"></a>\alpha &amp;\sim Normal(178, 20) \hspace{35pt}\beta \; prior \label{eq-alpha}<span class="sc">\\</span></span>
<span id="cb58-441"><a href="#cb58-441" aria-hidden="true" tabindex="-1"></a>\beta &amp;\sim Normal(178, 20) \hspace{35pt}\mu \; prior \label{eq-mu}<span class="sc">\\</span></span>
<span id="cb58-442"><a href="#cb58-442" aria-hidden="true" tabindex="-1"></a>\sigma &amp;\sim Uniform(0, 50) \hspace{35pt}\sigma \; prior \label{eq-sigma}</span>
<span id="cb58-443"><a href="#cb58-443" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb58-444"><a href="#cb58-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-445"><a href="#cb58-445" aria-hidden="true" tabindex="-1"></a>where the average of $x$ values is $\bar{x}$. Our predictor variablle is $x$, which is a list of measures of the same length as $h$. We now define $\mu$ as a function of the values in $x$ in order to include our predictor, weight, in the model. $\alpha$ is our intercept, $\beta$ is our slope.</span>
<span id="cb58-446"><a href="#cb58-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-447"><a href="#cb58-447" aria-hidden="true" tabindex="-1"></a><span class="fu">## Polynomial regression</span></span>
<span id="cb58-448"><a href="#cb58-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-449"><a href="#cb58-449" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solomon Kurz</span></span>
<span id="cb58-450"><a href="#cb58-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-453"><a href="#cb58-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-454"><a href="#cb58-454" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb58-455"><a href="#cb58-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-456"><a href="#cb58-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-457"><a href="#cb58-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-458"><a href="#cb58-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fitting a model with `brm()`</span></span>
<span id="cb58-459"><a href="#cb58-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-460"><a href="#cb58-460" aria-hidden="true" tabindex="-1"></a>Instead of <span class="in">`statrethinking::map()`</span></span>
<span id="cb58-461"><a href="#cb58-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-464"><a href="#cb58-464" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-465"><a href="#cb58-465" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> </span>
<span id="cb58-466"><a href="#cb58-466" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span></span>
<span id="cb58-467"><a href="#cb58-467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)</span>
<span id="cb58-468"><a href="#cb58-468" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-469"><a href="#cb58-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-470"><a href="#cb58-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-473"><a href="#cb58-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-474"><a href="#cb58-474" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb58-475"><a href="#cb58-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, </span>
<span id="cb58-476"><a href="#cb58-476" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb58-477"><a href="#cb58-477" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb58-478"><a href="#cb58-478" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb58-479"><a href="#cb58-479" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb58-480"><a href="#cb58-480" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb58-481"><a href="#cb58-481" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb58-482"><a href="#cb58-482" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"fits/b04.01"</span>))</span>
<span id="cb58-483"><a href="#cb58-483" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-484"><a href="#cb58-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-487"><a href="#cb58-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-488"><a href="#cb58-488" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.1</span>) </span>
<span id="cb58-489"><a href="#cb58-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-490"><a href="#cb58-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-493"><a href="#cb58-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-494"><a href="#cb58-494" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b4<span class="fl">.1</span>)</span>
<span id="cb58-495"><a href="#cb58-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-496"><a href="#cb58-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-497"><a href="#cb58-497" aria-hidden="true" tabindex="-1"></a>Or, if we want to use the 89\% intervals used in the textbook:</span>
<span id="cb58-498"><a href="#cb58-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-501"><a href="#cb58-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-502"><a href="#cb58-502" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.1</span>, <span class="at">prob =</span> .<span class="dv">89</span>)</span>
<span id="cb58-503"><a href="#cb58-503" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-504"><a href="#cb58-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-505"><a href="#cb58-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-506"><a href="#cb58-506" aria-hidden="true" tabindex="-1"></a>Now if we want very narrow priors (sd of 0.1!):</span>
<span id="cb58-507"><a href="#cb58-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-510"><a href="#cb58-510" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-511"><a href="#cb58-511" aria-hidden="true" tabindex="-1"></a>b4<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb58-512"><a href="#cb58-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d2, <span class="at">family =</span> gaussian,</span>
<span id="cb58-513"><a href="#cb58-513" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb58-514"><a href="#cb58-514" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="fl">0.1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb58-515"><a href="#cb58-515" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma, <span class="at">ub =</span> <span class="dv">50</span>)),</span>
<span id="cb58-516"><a href="#cb58-516" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb58-517"><a href="#cb58-517" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb58-518"><a href="#cb58-518" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"fits/b04.02"</span>))</span>
<span id="cb58-519"><a href="#cb58-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-520"><a href="#cb58-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-523"><a href="#cb58-523" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-524"><a href="#cb58-524" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(b4<span class="fl">.2</span>)</span>
<span id="cb58-525"><a href="#cb58-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-526"><a href="#cb58-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-527"><a href="#cb58-527" aria-hidden="true" tabindex="-1"></a>We see the chains actually look pretty good. Let's look at the fixed effects to easily compare the estimates of the two models:</span>
<span id="cb58-528"><a href="#cb58-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-531"><a href="#cb58-531" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-532"><a href="#cb58-532" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb58-533"><a href="#cb58-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(b4<span class="fl">.1</span>)<span class="sc">$</span>fixed <span class="sc">|&gt;</span> </span>
<span id="cb58-534"><a href="#cb58-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-535"><a href="#cb58-535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"b4.1"</span>),</span>
<span id="cb58-536"><a href="#cb58-536" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(b4<span class="fl">.2</span>)<span class="sc">$</span>fixed <span class="sc">|&gt;</span> </span>
<span id="cb58-537"><a href="#cb58-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb58-538"><a href="#cb58-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"b4.2"</span>)</span>
<span id="cb58-539"><a href="#cb58-539" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-540"><a href="#cb58-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-541"><a href="#cb58-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-542"><a href="#cb58-542" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampleing from a `brm()` fit</span></span>
<span id="cb58-543"><a href="#cb58-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-544"><a href="#cb58-544" aria-hidden="true" tabindex="-1"></a>Instead of using the <span class="in">`vcov()`</span> function from the <span class="in">`statrethinking`</span> package (<span class="in">`brms`</span> has a <span class="in">`vcov()`</span> function but it only gives the first element in the matrix), we can get it after putting the HMC chains in a data frame (which we do with <span class="in">`as_draws_df()`</span>):</span>
<span id="cb58-545"><a href="#cb58-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-548"><a href="#cb58-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-549"><a href="#cb58-549" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(b4<span class="fl">.1</span>)</span>
<span id="cb58-550"><a href="#cb58-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-551"><a href="#cb58-551" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(post)</span>
<span id="cb58-552"><a href="#cb58-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-553"><a href="#cb58-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-556"><a href="#cb58-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-557"><a href="#cb58-557" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(post, b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb58-558"><a href="#cb58-558" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>()</span>
<span id="cb58-559"><a href="#cb58-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-560"><a href="#cb58-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-561"><a href="#cb58-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-562"><a href="#cb58-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-563"><a href="#cb58-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-564"><a href="#cb58-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-565"><a href="#cb58-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-566"><a href="#cb58-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-567"><a href="#cb58-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-568"><a href="#cb58-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-569"><a href="#cb58-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-570"><a href="#cb58-570" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practice</span></span>
<span id="cb58-571"><a href="#cb58-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-572"><a href="#cb58-572" aria-hidden="true" tabindex="-1"></a><span class="fu">### E1 {.unnumbered}</span></span>
<span id="cb58-573"><a href="#cb58-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-574"><a href="#cb58-574" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In the model definition below, which line is the likelihood?</span></span>
<span id="cb58-575"><a href="#cb58-575" aria-hidden="true" tabindex="-1"></a><span class="at">\begin{align}</span></span>
<span id="cb58-576"><a href="#cb58-576" aria-hidden="true" tabindex="-1"></a><span class="at">y_i &amp;\sim Normal(\mu,\sigma) \label{ex-e1a} </span><span class="sc">\\</span></span>
<span id="cb58-577"><a href="#cb58-577" aria-hidden="true" tabindex="-1"></a><span class="at">\mu &amp;\sim Normal(0,10) \label{ex-e1b} </span><span class="sc">\\</span></span>
<span id="cb58-578"><a href="#cb58-578" aria-hidden="true" tabindex="-1"></a><span class="at">\sigma &amp;\sim Exponential(1) \label{ex-e1c}</span></span>
<span id="cb58-579"><a href="#cb58-579" aria-hidden="true" tabindex="-1"></a><span class="at">\end{align}</span></span>
<span id="cb58-580"><a href="#cb58-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-581"><a href="#cb58-581" aria-hidden="true" tabindex="-1"></a>\ref{ex-e1a} is the likelihood (\ref{ex-e1b} is the prior for $\mu$ and \ref{ex-e1c} for $\sigma$)</span>
<span id="cb58-582"><a href="#cb58-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-583"><a href="#cb58-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### E2 {.unnumbered}</span></span>
<span id="cb58-584"><a href="#cb58-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-585"><a href="#cb58-585" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In the model definition just above, how many parameters are in the posterior distribution?</span></span>
<span id="cb58-586"><a href="#cb58-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-587"><a href="#cb58-587" aria-hidden="true" tabindex="-1"></a>There are two parameters in the posterior distribution: $\mu$ and $\sigma$</span>
<span id="cb58-588"><a href="#cb58-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-589"><a href="#cb58-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### E3 {.unnumbered}</span></span>
<span id="cb58-590"><a href="#cb58-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-591"><a href="#cb58-591" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Using the model definition above, write down the appropriate form of Bayes’ theorem that includes the proper likelihood and priors.</span></span>
<span id="cb58-592"><a href="#cb58-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-593"><a href="#cb58-593" aria-hidden="true" tabindex="-1"></a>Bayes' theorem is:</span>
<span id="cb58-594"><a href="#cb58-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-595"><a href="#cb58-595" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb58-596"><a href="#cb58-596" aria-hidden="true" tabindex="-1"></a>P(A|B) = \frac{P(B|A)P(A)}{P(B)}</span>
<span id="cb58-597"><a href="#cb58-597" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb58-598"><a href="#cb58-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-599"><a href="#cb58-599" aria-hidden="true" tabindex="-1"></a>Where $A$ is our priors and $B$ is the posterior, i.e., observed data ($y$) I'm guessing? And so...</span>
<span id="cb58-600"><a href="#cb58-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-601"><a href="#cb58-601" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb58-602"><a href="#cb58-602" aria-hidden="true" tabindex="-1"></a>P(\mu,\sigma|y) = \frac{P(y|\mu,\sigma)P(\mu)P(\sigma)}{P(y)}</span>
<span id="cb58-603"><a href="#cb58-603" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb58-604"><a href="#cb58-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-605"><a href="#cb58-605" aria-hidden="true" tabindex="-1"></a>Okay I really don't know...I guess we add in the model parameter definitions?</span>
<span id="cb58-606"><a href="#cb58-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-607"><a href="#cb58-607" aria-hidden="true" tabindex="-1"></a><span class="fu">### E4 {.unnumbered}</span></span>
<span id="cb58-608"><a href="#cb58-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-609"><a href="#cb58-609" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In the model definition below, which line is the linear model?</span></span>
<span id="cb58-610"><a href="#cb58-610" aria-hidden="true" tabindex="-1"></a><span class="at">\begin{align}</span></span>
<span id="cb58-611"><a href="#cb58-611" aria-hidden="true" tabindex="-1"></a><span class="at">y_i &amp;\sim Normal(\mu,\sigma) \label{ex-e4a} </span><span class="sc">\\</span></span>
<span id="cb58-612"><a href="#cb58-612" aria-hidden="true" tabindex="-1"></a><span class="at">\mu &amp;= \alpha + \beta x_i \label{ex-e4b} </span><span class="sc">\\</span></span>
<span id="cb58-613"><a href="#cb58-613" aria-hidden="true" tabindex="-1"></a><span class="at">\alpha &amp;\sim Normal(0,10) \label{ex-e4c} </span><span class="sc">\\</span></span>
<span id="cb58-614"><a href="#cb58-614" aria-hidden="true" tabindex="-1"></a><span class="at">\beta &amp;\sim Normal(0,1) \label{ex-e4d} </span><span class="sc">\\</span></span>
<span id="cb58-615"><a href="#cb58-615" aria-hidden="true" tabindex="-1"></a><span class="at">\sigma &amp;\sim Exponential(2) \label{ex-e4e}</span></span>
<span id="cb58-616"><a href="#cb58-616" aria-hidden="true" tabindex="-1"></a><span class="at">\end{align}</span></span>
<span id="cb58-617"><a href="#cb58-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-618"><a href="#cb58-618" aria-hidden="true" tabindex="-1"></a>\ref{ex-e4b} is the linear model. \label{ex-e4a} is the likelihood, \label{ex-e4c} the prior for $\alpha$ (intercept), \label{ex-e4d} the prior for $\beta$ (slope), and \label{ex-e4e} the prior for sigma (sd).</span>
<span id="cb58-619"><a href="#cb58-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-620"><a href="#cb58-620" aria-hidden="true" tabindex="-1"></a><span class="fu">### E5 {.unnumbered}</span></span>
<span id="cb58-621"><a href="#cb58-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-622"><a href="#cb58-622" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In the model definition just above, how many parameters are in the posterior distribution?</span></span>
<span id="cb58-623"><a href="#cb58-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-624"><a href="#cb58-624" aria-hidden="true" tabindex="-1"></a>The posterior distribution has the parameters:</span>
<span id="cb58-625"><a href="#cb58-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-626"><a href="#cb58-626" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\sigma$: standard deviation</span>
<span id="cb58-627"><a href="#cb58-627" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\alpha$: intercept</span>
<span id="cb58-628"><a href="#cb58-628" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta$: slope</span>
<span id="cb58-629"><a href="#cb58-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-630"><a href="#cb58-630" aria-hidden="true" tabindex="-1"></a><span class="fu">### M1 {.unnumbered}</span></span>
<span id="cb58-631"><a href="#cb58-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-632"><a href="#cb58-632" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; For the model definition below, simulate observed y values from the prior (not the posterior).</span></span>
<span id="cb58-633"><a href="#cb58-633" aria-hidden="true" tabindex="-1"></a><span class="at">\begin{align}</span></span>
<span id="cb58-634"><a href="#cb58-634" aria-hidden="true" tabindex="-1"></a><span class="at">y_i &amp;\sim Normal(\mu,\sigma) \label{ex-m1a} </span><span class="sc">\\</span></span>
<span id="cb58-635"><a href="#cb58-635" aria-hidden="true" tabindex="-1"></a><span class="at">\mu &amp;\sim Normal(0,10) \label{ex-m1b} </span><span class="sc">\\</span></span>
<span id="cb58-636"><a href="#cb58-636" aria-hidden="true" tabindex="-1"></a><span class="at">\sigma &amp;\sim Exponential(1) \label{ex-m1c}</span></span>
<span id="cb58-637"><a href="#cb58-637" aria-hidden="true" tabindex="-1"></a><span class="at">\end{align}</span></span>
<span id="cb58-638"><a href="#cb58-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-641"><a href="#cb58-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-642"><a href="#cb58-642" aria-hidden="true" tabindex="-1"></a><span class="co"># same as R chunk 4.14</span></span>
<span id="cb58-643"><a href="#cb58-643" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb58-644"><a href="#cb58-644" aria-hidden="true" tabindex="-1"></a>sample_sigma <span class="ot">&lt;-</span> <span class="fu">rexp</span>(<span class="fl">1e4</span>, <span class="dv">1</span>)</span>
<span id="cb58-645"><a href="#cb58-645" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate prior predictive values</span></span>
<span id="cb58-646"><a href="#cb58-646" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, sample_mu, sample_sigma)</span>
<span id="cb58-647"><a href="#cb58-647" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(prior_h)</span>
<span id="cb58-648"><a href="#cb58-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-649"><a href="#cb58-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-650"><a href="#cb58-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-651"><a href="#cb58-651" aria-hidden="true" tabindex="-1"></a>And our prior predictive with ggplot:</span>
<span id="cb58-652"><a href="#cb58-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-655"><a href="#cb58-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-656"><a href="#cb58-656" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb58-657"><a href="#cb58-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-658"><a href="#cb58-658" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb58-659"><a href="#cb58-659" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">sample_mu    =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>,       <span class="at">sd  =</span> <span class="dv">10</span>),</span>
<span id="cb58-660"><a href="#cb58-660" aria-hidden="true" tabindex="-1"></a>       <span class="at">sample_sigma =</span> <span class="fu">rexp</span>(n, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-661"><a href="#cb58-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> sample_mu, <span class="at">sd  =</span> sample_sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-662"><a href="#cb58-662" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-663"><a href="#cb58-663" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb58-664"><a href="#cb58-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">0</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb58-665"><a href="#cb58-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb58-666"><a href="#cb58-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(Prior<span class="sc">~</span>predictive<span class="sc">~</span>distribution<span class="sc">~</span><span class="st">"for"</span><span class="sc">~</span><span class="fu">italic</span>(h[i])),</span>
<span id="cb58-667"><a href="#cb58-667" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb58-668"><a href="#cb58-668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span>
<span id="cb58-669"><a href="#cb58-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-670"><a href="#cb58-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-671"><a href="#cb58-671" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sampling from the posterior</span></span>
<span id="cb58-672"><a href="#cb58-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-675"><a href="#cb58-675" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-676"><a href="#cb58-676" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.15</span></span>
<span id="cb58-677"><a href="#cb58-677" aria-hidden="true" tabindex="-1"></a>sample_mu <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( <span class="fl">1e4</span> , <span class="dv">178</span> , <span class="dv">100</span> ) </span>
<span id="cb58-678"><a href="#cb58-678" aria-hidden="true" tabindex="-1"></a>prior_h <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( <span class="fl">1e4</span> , sample_mu , sample_sigma ) </span>
<span id="cb58-679"><a href="#cb58-679" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>( prior_h )</span>
<span id="cb58-680"><a href="#cb58-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-681"><a href="#cb58-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-682"><a href="#cb58-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-685"><a href="#cb58-685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-686"><a href="#cb58-686" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.16</span></span>
<span id="cb58-687"><a href="#cb58-687" aria-hidden="true" tabindex="-1"></a>mu.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">150</span>, <span class="at">to=</span><span class="dv">160</span> , <span class="at">length.out=</span><span class="dv">100</span> ) </span>
<span id="cb58-688"><a href="#cb58-688" aria-hidden="true" tabindex="-1"></a>sigma.list <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from=</span><span class="dv">7</span> , <span class="at">to=</span><span class="dv">9</span> , <span class="at">length.out=</span><span class="dv">100</span> ) </span>
<span id="cb58-689"><a href="#cb58-689" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>( <span class="at">mu=</span>mu.list , <span class="at">sigma=</span>sigma.list ) </span>
<span id="cb58-690"><a href="#cb58-690" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>LL <span class="ot">&lt;-</span> <span class="fu">sapply</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post) , <span class="cf">function</span>(i) </span>
<span id="cb58-691"><a href="#cb58-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>( <span class="fu">dnorm</span>( d2<span class="sc">$</span>height , post<span class="sc">$</span>mu[i] , post<span class="sc">$</span>sigma[i] , <span class="at">log=</span><span class="cn">TRUE</span> ) ) ) </span>
<span id="cb58-692"><a href="#cb58-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-693"><a href="#cb58-693" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prod <span class="ot">&lt;-</span> post<span class="sc">$</span>LL <span class="sc">+</span> <span class="fu">dnorm</span>( post<span class="sc">$</span>mu , <span class="dv">178</span> , <span class="dv">20</span> , <span class="cn">TRUE</span> ) <span class="sc">+</span> <span class="fu">dunif</span>( post<span class="sc">$</span>sigma , <span class="dv">0</span> , <span class="dv">50</span> , <span class="cn">TRUE</span> ) </span>
<span id="cb58-694"><a href="#cb58-694" aria-hidden="true" tabindex="-1"></a>post<span class="sc">$</span>prob <span class="ot">&lt;-</span> <span class="fu">exp</span>( post<span class="sc">$</span>prod <span class="sc">-</span> <span class="fu">max</span>(post<span class="sc">$</span>prod) )</span>
<span id="cb58-695"><a href="#cb58-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-696"><a href="#cb58-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-699"><a href="#cb58-699" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-700"><a href="#cb58-700" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.17</span></span>
<span id="cb58-701"><a href="#cb58-701" aria-hidden="true" tabindex="-1"></a>sample.rows <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(post) , <span class="at">size=</span><span class="fl">1e4</span> , <span class="at">replace=</span><span class="cn">TRUE</span> , <span class="at">prob=</span>post<span class="sc">$</span>prob ) </span>
<span id="cb58-702"><a href="#cb58-702" aria-hidden="true" tabindex="-1"></a>sample.mu <span class="ot">&lt;-</span> post<span class="sc">$</span>mu[ sample.rows ] </span>
<span id="cb58-703"><a href="#cb58-703" aria-hidden="true" tabindex="-1"></a>sample.sigma <span class="ot">&lt;-</span> post<span class="sc">$</span>sigma[ sample.rows ]</span>
<span id="cb58-704"><a href="#cb58-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-705"><a href="#cb58-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-708"><a href="#cb58-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-709"><a href="#cb58-709" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.21</span></span>
<span id="cb58-710"><a href="#cb58-710" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample_mu)</span>
<span id="cb58-711"><a href="#cb58-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-712"><a href="#cb58-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-715"><a href="#cb58-715" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-716"><a href="#cb58-716" aria-hidden="true" tabindex="-1"></a><span class="co"># R chunk 4.21</span></span>
<span id="cb58-717"><a href="#cb58-717" aria-hidden="true" tabindex="-1"></a><span class="fu">dens</span>(sample_sigma)</span>
<span id="cb58-718"><a href="#cb58-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb58-719"><a href="#cb58-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-720"><a href="#cb58-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### M2 {.unnumbered}</span></span>
<span id="cb58-721"><a href="#cb58-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-722"><a href="#cb58-722" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Translate the model just above into a quap formula.</span></span>
<span id="cb58-723"><a href="#cb58-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-724"><a href="#cb58-724" aria-hidden="true" tabindex="-1"></a>Do this as in R chunk 4.26:</span>
<span id="cb58-725"><a href="#cb58-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-728"><a href="#cb58-728" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb58-729"><a href="#cb58-729" aria-hidden="true" tabindex="-1"></a>flist <span class="ot">&lt;-</span></span>
<span id="cb58-730"><a href="#cb58-730" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(height <span class="sc">~</span> <span class="fu">dnorm</span>(mu , sigma) , </span>
<span id="cb58-731"><a href="#cb58-731" aria-hidden="true" tabindex="-1"></a>        mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span> , <span class="dv">10</span>) , </span>
<span id="cb58-732"><a href="#cb58-732" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">0</span> , <span class="dv">1</span>)</span>
<span id="cb58-733"><a href="#cb58-733" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb58-734"><a href="#cb58-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>